import { __spreadArrays } from "tslib";
// (C) 2021 GoodData Corporation
import flatMap from "lodash/flatMap";
import { dataLoaderAbstractFactory } from "./DataLoaderAbstractFactory";
var AttributesWithDrillDownDataLoader = /** @class */ (function () {
    function AttributesWithDrillDownDataLoader(workspace) {
        this.workspace = workspace;
    }
    AttributesWithDrillDownDataLoader.prototype.getAttributesWithDrillDown = function (backend) {
        var _this = this;
        if (!this.cachedAttributesWithDrillDown) {
            this.cachedAttributesWithDrillDown = backend
                .workspace(this.workspace)
                .catalog()
                .forTypes(["attribute", "dateDataset"])
                .load()
                .then(function (catalog) {
                var attributes = catalog.attributes();
                var dateAttributes = flatMap(catalog.dateDatasets(), function (dd) { return dd.dateAttributes; });
                return __spreadArrays(attributes, dateAttributes).filter(function (attr) { return attr.attribute.drillDownStep; });
            })
                .catch(function (error) {
                _this.cachedAttributesWithDrillDown = undefined;
                throw error;
            });
        }
        return this.cachedAttributesWithDrillDown;
    };
    return AttributesWithDrillDownDataLoader;
}());
/**
 * @internal
 */
export var attributesWithDrillDownDataLoaderFactory = dataLoaderAbstractFactory(function (workspace) { return new AttributesWithDrillDownDataLoader(workspace); });
//# sourceMappingURL=AttributesWithDrillDownDataLoader.js.map