// (C) 2021 GoodData Corporation
import { isInsightWidget, isKpiWidget } from "@gooddata/sdk-backend-spi";
import { serializeObjRef } from "@gooddata/sdk-model";
import { invalidArgumentsProvided } from "../../../events/general";
/**
 * Given list of all dashboard widgets and a command that contains a ref, this function tests that the `ref` is
 * a reference to an existing dashboard widget and that the existing widget is an insight widget.
 *
 * If the validation succeeds, the located insight widget will be returned. Otherwise an error will fly. The error
 * will be an instance of DashboardCommandFailed event - it can be propagated through the command handler all the
 * way to the root command handler saga.
 *
 * @param ctx - dashboard context, this will be included in the DashboardCommandFailed event
 * @param widgets - map of widgets on the dashboard
 * @param cmd - any command that has 'ref' in its payload
 */
export function validateExistingInsightWidget(widgets, cmd, ctx) {
    var ref = cmd.payload.ref;
    var widget = widgets.get(ref);
    if (!widget) {
        throw invalidArgumentsProvided(ctx, cmd, "Cannot find insight widget with ref: " + serializeObjRef(ref) + ".");
    }
    if (!isInsightWidget(widget)) {
        throw invalidArgumentsProvided(ctx, cmd, "Widget with ref: " + serializeObjRef(ref) + " exists but is not an insight widget.");
    }
    return widget;
}
/**
 * Given list of all dashboard widgets and a command that contains a ref, this function tests that the `ref` is
 * a reference to an existing dashboard widget and that the existing widget is a KPI widget.
 *
 * If the validation succeeds, the located KPI widget will be returned. Otherwise an error will fly. The error
 * will be an instance of DashboardCommandFailed event - it can be propagated through the command handler all the
 * way to the root command handler saga.
 *
 * @param ctx - dashboard context, this will be included in the DashboardCommandFailed event
 * @param widgets - map of widgets on the dashboard
 * @param cmd - any command that has 'ref' in its payload
 */
export function validateExistingKpiWidget(widgets, cmd, ctx) {
    var ref = cmd.payload.ref;
    var widget = widgets.get(ref);
    if (!widget) {
        throw invalidArgumentsProvided(ctx, cmd, "Cannot find insight widget with ref: " + serializeObjRef(ref) + ".");
    }
    if (!isKpiWidget(widget)) {
        throw invalidArgumentsProvided(ctx, cmd, "Widget with ref: " + serializeObjRef(ref) + " exists but is not a KPI widget.");
    }
    return widget;
}
//# sourceMappingURL=widgetValidations.js.map