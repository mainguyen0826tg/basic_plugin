// (C) 2021 GoodData Corporation
import { __generator } from "tslib";
import { selectWidgetsMap } from "../../store/layout/layoutSelectors";
import { put, select } from "redux-saga/effects";
import { validateExistingInsightWidget } from "./validation/widgetValidations";
import { layoutActions } from "../../store/layout";
import { insightWidgetVisPropertiesChanged } from "../../events/insight";
export function changeInsightWidgetVisPropertiesHandler(ctx, cmd) {
    var properties, correlationId, widgets, insightWidget;
    return __generator(this, function (_a) {
        switch (_a.label) {
            case 0:
                properties = cmd.payload.properties, correlationId = cmd.correlationId;
                return [4 /*yield*/, select(selectWidgetsMap)];
            case 1:
                widgets = _a.sent();
                insightWidget = validateExistingInsightWidget(widgets, cmd, ctx);
                return [4 /*yield*/, put(layoutActions.replaceInsightWidgetVisProperties({
                        ref: insightWidget.ref,
                        properties: properties,
                        undo: {
                            cmd: cmd,
                        },
                    }))];
            case 2:
                _a.sent();
                return [2 /*return*/, insightWidgetVisPropertiesChanged(ctx, insightWidget.ref, properties, correlationId)];
        }
    });
}
//# sourceMappingURL=changeInsightWidgetVisPropertiesHandler.js.map