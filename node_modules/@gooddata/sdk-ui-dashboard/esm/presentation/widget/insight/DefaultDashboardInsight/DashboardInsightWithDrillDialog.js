import { __assign, __read, __spread } from "tslib";
// (C) 2020 GoodData Corporation
import React, { useState } from "react";
import last from "lodash/last";
import { selectLocale, useDashboardSelector } from "../../../../model";
import { getDrillDownAttributeTitle } from "../../../drill";
import { isDrillDownDefinition } from "../../../../types";
import { getDrillOriginLocalIdentifier } from "../../../../_staging/drills/drillingUtils";
import { DashboardInsightWithDrillSelect } from "./Insight/DashboardInsightWithDrillSelect";
import { InsightDrillDialog } from "./InsightDrillDialog/InsightDrillDialog";
/**
 * @internal
 */
export var DashboardInsightWithDrillDialog = function (props) {
    var _a = __read(useState([]), 2), drillSteps = _a[0], setDrillSteps = _a[1];
    var activeDrillStep = last(drillSteps);
    var insight = activeDrillStep === null || activeDrillStep === void 0 ? void 0 : activeDrillStep.insight;
    var widget = props.widget;
    var breadcrumbs = drillSteps
        .filter(function (s) { return isDrillDownDefinition(s.drillDefinition); })
        .map(function (s) {
        return getDrillDownAttributeTitle(getDrillOriginLocalIdentifier(s.drillDefinition), s.drillEvent);
    });
    var locale = useDashboardSelector(selectLocale);
    var setNextDrillStep = function (drillStep) {
        setDrillSteps(function (s) { return __spread(s, [drillStep]); });
    };
    var goBack = function () { return setDrillSteps(function (_a) {
        var _b = __read(_a, 1), firstDrill = _b[0];
        return [firstDrill];
    }); };
    var onClose = function () { return setDrillSteps([]); };
    return (React.createElement(React.Fragment, null,
        React.createElement(DashboardInsightWithDrillSelect, __assign({}, props, { onDrillDown: function (evt) { return setNextDrillStep(evt.payload); }, onDrillToInsight: function (evt) { return setNextDrillStep(evt.payload); } })),
        activeDrillStep && (React.createElement(InsightDrillDialog, { locale: locale, breadcrumbs: breadcrumbs, widget: widget, insight: insight, onDrillDown: function (evt) { return setNextDrillStep(evt.payload); }, onBackButtonClick: goBack, onClose: onClose }))));
};
//# sourceMappingURL=DashboardInsightWithDrillDialog.js.map