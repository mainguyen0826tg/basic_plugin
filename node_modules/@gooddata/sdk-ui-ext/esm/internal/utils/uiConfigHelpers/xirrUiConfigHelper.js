import { __assign } from "tslib";
// (C) 2019-2020 GoodData Corporation
import cloneDeep from "lodash/cloneDeep";
import set from "lodash/set";
import { BucketNames, VisualizationTypes } from "@gooddata/sdk-ui";
import { DEFAULT_XIRR_UICONFIG } from "../../constants/uiConfig";
import { BUCKETS } from "../../constants/bucket";
import { hasNoMeasures, hasNoAttribute } from "../bucketRules";
import { setBucketTitles, getItemsCount } from "../bucketHelper";
export var getDefaultXirrUiConfig = function () { return cloneDeep(DEFAULT_XIRR_UICONFIG); };
function getCustomError(_a, formatMessage) {
    var buckets = _a.buckets;
    var measuresCount = getItemsCount(buckets, BucketNames.MEASURES);
    var attributeCount = getItemsCount(buckets, BucketNames.ATTRIBUTE);
    if (measuresCount === 0 || attributeCount === 0) {
        return {
            heading: formatMessage({ id: "dashboard.xirr.error.invalid_buckets.heading" }),
            text: formatMessage({ id: "dashboard.xirr.error.invalid_buckets.text" }),
        };
    }
    return undefined;
}
export var getXirrUiConfig = function (referencePoint, intl) {
    var _a;
    var uiConfig = setBucketTitles(__assign(__assign({}, referencePoint), { uiConfig: getDefaultXirrUiConfig() }), VisualizationTypes.XIRR, intl);
    var buckets = (_a = referencePoint === null || referencePoint === void 0 ? void 0 : referencePoint.buckets) !== null && _a !== void 0 ? _a : [];
    var canAddMeasures = hasNoMeasures(buckets);
    var canAddAttribute = hasNoAttribute(buckets);
    set(uiConfig, [BUCKETS, BucketNames.MEASURES, "canAddItems"], canAddMeasures);
    set(uiConfig, [BUCKETS, BucketNames.ATTRIBUTE, "canAddItems"], canAddAttribute);
    uiConfig.customError = getCustomError(referencePoint, intl.formatMessage);
    return uiConfig;
};
//# sourceMappingURL=xirrUiConfigHelper.js.map