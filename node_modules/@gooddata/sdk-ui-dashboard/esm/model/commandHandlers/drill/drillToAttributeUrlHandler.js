import { __generator, __read } from "tslib";
import { all, call, put, select } from "redux-saga/effects";
import { drillToAttributeUrlRequested, drillToAttributeUrlResolved, } from "../../events/drill";
import { resolveDrillToAttributeUrl } from "./resolveDrillToAttributeUrl";
import { getDrillToUrlFiltersWithResolvedValues } from "./getDrillToUrlFilters";
import { selectWidgetDrills } from "../../store/layout/layoutSelectors";
import { isDrillConfigured } from "../../../_staging/drills/drillingUtils";
export function drillToAttributeUrlHandler(ctx, cmd) {
    var _a, resolvedUrl, filtersInfo, widgetRef, widgetConfiguredDrills, isImplicit;
    return __generator(this, function (_b) {
        switch (_b.label) {
            case 0: return [4 /*yield*/, put(drillToAttributeUrlRequested(ctx, cmd.payload.drillDefinition, cmd.payload.drillEvent, cmd.correlationId))];
            case 1:
                _b.sent();
                return [4 /*yield*/, all([
                        call(resolveDrillToAttributeUrl, cmd.payload.drillDefinition, cmd.payload.drillEvent, ctx),
                        call(getDrillToUrlFiltersWithResolvedValues, ctx, cmd.payload.drillEvent.widgetRef),
                    ])];
            case 2:
                _a = __read.apply(void 0, [_b.sent(), 2]), resolvedUrl = _a[0], filtersInfo = _a[1];
                widgetRef = cmd.payload.drillEvent.widgetRef;
                return [4 /*yield*/, select(selectWidgetDrills(widgetRef))];
            case 3:
                widgetConfiguredDrills = _b.sent();
                isImplicit = !isDrillConfigured(cmd.payload.drillDefinition, widgetConfiguredDrills);
                return [2 /*return*/, drillToAttributeUrlResolved(ctx, resolvedUrl, cmd.payload.drillDefinition, cmd.payload.drillEvent, filtersInfo, isImplicit, cmd.correlationId)];
        }
    });
}
//# sourceMappingURL=drillToAttributeUrlHandler.js.map