import { __awaiter, __generator } from "tslib";
// (C) 2019-2020 GoodData Corporation
import invariant from "ts-invariant";
import { convertMetadataObjectXrefEntry } from "../../../convertors/fromBackend/MetaConverter";
import { getObjectIdFromUri, objRefToUri } from "../../../utils/api";
var BearWorkspaceFacts = /** @class */ (function () {
    function BearWorkspaceFacts(authCall, workspace) {
        this.authCall = authCall;
        this.workspace = workspace;
    }
    BearWorkspaceFacts.prototype.getFactDatasetMeta = function (ref) {
        return __awaiter(this, void 0, void 0, function () {
            var uri, objectId;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, objRefToUri(ref, this.workspace, this.authCall)];
                    case 1:
                        uri = _a.sent();
                        objectId = getObjectIdFromUri(uri);
                        return [2 /*return*/, this.authCall(function (sdk) { return __awaiter(_this, void 0, void 0, function () {
                                var usedBy;
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, sdk.xhr.getParsed("/gdc/md/" + this.workspace + "/usedby2/" + objectId + "?types=dataSet")];
                                        case 1:
                                            usedBy = _a.sent();
                                            invariant(usedBy.entries.length > 0, "Fact must have a dataset associated to it.");
                                            return [2 /*return*/, convertMetadataObjectXrefEntry("dataSet", usedBy.entries[0])];
                                    }
                                });
                            }); })];
                }
            });
        });
    };
    return BearWorkspaceFacts;
}());
export { BearWorkspaceFacts };
//# sourceMappingURL=index.js.map