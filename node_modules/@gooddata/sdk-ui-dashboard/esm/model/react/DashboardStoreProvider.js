// (C) 2021 GoodData Corporation
import React from "react";
import { createDispatchHook, createSelectorHook, Provider } from "react-redux";
import { DashboardEventsProvider } from "./DashboardEventsContext";
import { useInitializeDashboardStore } from "./useInitializeDashboardStore";
/**
 * @alpha
 */
export var ReactDashboardContext = React.createContext(null);
/**
 * @alpha
 */
export var useDashboardDispatch = createDispatchHook(ReactDashboardContext);
/**
 * @alpha
 */
export var useDashboardSelector = createSelectorHook(ReactDashboardContext);
/**
 * @internal
 */
export var DashboardStoreProvider = function (props) {
    var dashboardStore = useInitializeDashboardStore(props);
    var additionalReduxContext = props.additionalReduxContext;
    if (!dashboardStore) {
        return null;
    }
    if (additionalReduxContext != undefined && additionalReduxContext !== ReactDashboardContext) {
        /*
         * Setting store into multiple contexts is essential in environments where a dynamically loaded
         * dashboard engine is integrated into an application that adds additional embedded, local plugins
         * which use Redux hooks (useDashboardSelector, useDashboardDispatch)
         *
         * Such local code is typically built against a local version of the sdk-ui-dashboard and has
         * different redux context providers from those used by dynamically loaded engine bundle.
         *
         * When the local code uses redux hooks, it will explode because they look into a different context
         * where the store is unset.
         */
        return (React.createElement(Provider, { store: dashboardStore.store, context: ReactDashboardContext },
            React.createElement(Provider, { store: dashboardStore.store, context: additionalReduxContext },
                React.createElement(DashboardEventsProvider, { registerHandler: dashboardStore.registerEventHandler, unregisterHandler: dashboardStore.unregisterEventHandler }, props.children))));
    }
    return (React.createElement(Provider, { store: dashboardStore.store, context: ReactDashboardContext },
        React.createElement(DashboardEventsProvider, { registerHandler: dashboardStore.registerEventHandler, unregisterHandler: dashboardStore.unregisterEventHandler }, props.children)));
};
//# sourceMappingURL=DashboardStoreProvider.js.map