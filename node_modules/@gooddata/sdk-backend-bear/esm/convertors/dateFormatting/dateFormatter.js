// (C) 2020-2021 GoodData Corporation
import { isAttributeDescriptor, isResultAttributeHeader, } from "@gooddata/sdk-backend-spi";
import { createDateValueFormatter } from "./dateValueFormatter";
import { DEFAULT_DATE_FORMAT } from "./dateValueParser";
import { createDefaultDateFormatter } from "./defaultDateFormatter";
// TODO: rewrite. move search for date attributes into data view facade / meta() section
export function findDateAttributeUris(dimensions) {
    var dateAttrsDescriptor = dimensions
        .reduce(function (attrDimensions, dimensionItem) {
        attrDimensions.push.apply(attrDimensions, dimensionItem.headers.filter(isAttributeDescriptor));
        return attrDimensions;
    }, [])
        .filter(function (attrDescriptor) {
        return attrDescriptor.attributeHeader.type === "GDC.time.day_us";
    });
    return dateAttrsDescriptor.map(function (dateAttrDescriptor) { return dateAttrDescriptor.attributeHeader.formOf.uri; });
}
export function transformDateFormat(resultHeader, dateAttributeUris, dateFormat) {
    if (!isResultAttributeHeader(resultHeader) ||
        !(dateAttributeUris === null || dateAttributeUris === void 0 ? void 0 : dateAttributeUris.length) ||
        !dateFormat ||
        dateFormat === DEFAULT_DATE_FORMAT) {
        return resultHeader;
    }
    var resultHeaderUri = resultHeader.attributeHeaderItem.uri;
    var foundUri = dateAttributeUris.some(function (dateAttributeUri) {
        return resultHeaderUri.startsWith(dateAttributeUri);
    });
    if (!foundUri) {
        return resultHeader;
    }
    try {
        var dateValueFormatter = createDateValueFormatter(createDefaultDateFormatter(dateFormat));
        return {
            attributeHeaderItem: {
                name: dateValueFormatter(resultHeader.attributeHeaderItem.name),
                uri: resultHeaderUri,
            },
        };
    }
    catch (_a) {
        return resultHeader;
    }
}
//# sourceMappingURL=dateFormatter.js.map